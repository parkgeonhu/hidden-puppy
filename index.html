<!DOCTYPE HTML>

<head>
    <title>20171622 박건후 기말 프로젝트</title>

    <script>
        var stageNum = 2;
        var nowStage = 0;

        var stageAnswerCntArr = [3, 5, 8];
        var stageCheckAvailArr=[6, 10, 16];

        var answerArr = [];

        var userClickcnt;
    

        function checkAnswer(id, img) {
            let answer_count = stageAnswerCntArr[nowStage];
            for (let i = 0; i < answerArr.length; i++) {
                if (id == answerArr[0]) {
                    img.setAttribute("src", "media/img2.gif");
                    answerArr.shift();
                }
            }
            
            if(answerArr.length==0){
                alert("정답을 모두 맞추었습니다!");
                nowStage++;
                changeScene("win");
            }
        }


        function createAnswer() {
            let answer_count = stageAnswerCntArr[nowStage];
            for (let i = 0; i < answer_count; i++) {
                var choiceValue = Math.floor(Math.random() * 24);
                let overlapCheck = false;
                for (let j = 0; j < i; j++) {
                    if (choiceValue == answerArr[j]) {
                        i--;
                        overlapCheck = true;
                        break;
                    }
                }
                if (!overlapCheck) {
                    answerArr.push(choiceValue);
                }
            }
        }
        
        function initScene(){
            var scene = document.getElementById("scene_view");
            while ( scene.hasChildNodes() ) {
                scene.removeChild( scene.firstChild );
            }
            return scene;
        }

        function gameOverScene() {
            
            var scene=initScene();
            var gameOverImg = document.createElement("IMG");
            gameOverImg.setAttribute("src", "media/gameover.jpg");
            gameOverImg.setAttribute("id", "gameover_img");
            
            scene.appendChild(gameOverImg);

        }
        
        function init(){
            var scene=initScene();
        }

        function changeScene(scene) {
            switch(scene){
                case "win":
                    if(nowStage<stageNum){
                        init();
                    }
                    else{
                        alert("축하합니다. 모든 스테이지를 깨셨습니다.");
                    }
                    break;
                case "lose":
                    gameOverScene();
                    break;
            }
        }

        //        function createImg(){
        //            var scene=document.getElementById("scene_view");
        //            for(let i=0;i<24;i++){
        //                var eggImg = document.createElement("IMG");
        //                eggImg.setAttribute("src", "media/img1.gif");
        //                eggImg.setAttribute("id", "egg_img");
        //                eggImg.onclick = function(){
        //                    checkAnswer(i, this);
        //                }
        //                scene.appendChild(eggImg);
        //            }
        //        }
        //        
        // 처음 정답을 알려주는 scene
        function createGameScene() {
            var scene = document.getElementById("scene_view");
            var egg_wrapper = document.createElement("div");
            egg_wrapper.setAttribute("id", "egg_wrapper");

            let tempAnswerArr = answerArr.slice();
            //            tempAnswerArr.sort();

            for (let i = 0; i < 24; i++) {
                let imgSrc = "media/img1.gif";
                for (let j = 0; j < stageAnswerCntArr[nowStage]; j++) {
                    if (i==answerArr[j]) {
                        imgSrc = "media/egg/egg" + String(j + 1 + ".png");
                        break;
                    }
                }

                var eggImg = document.createElement("IMG");
                eggImg.setAttribute("src", imgSrc);
                eggImg.setAttribute("id", "egg_img");
                eggImg.onclick = function() {
                    checkAnswer(i, this);
                }
                egg_wrapper.appendChild(eggImg);
            }
            scene.appendChild(egg_wrapper);

        }

    </script>

    <style>
        body {
            width: 98%;
        }

        #game_wrapper {
            width: 98%;
            /*            background-color: antiquewhite;*/
        }

        #aside,
        #scene_view {
            margin-left: 2%;
            margin-right: 2%;
            background-color: #CEFF84;
            width: 75%;
            float: left;
        }

        #aside {
            background-color: aqua;
            width: 15%;
            height: 100px;
            float: left;
        }

        #egg_img {
            width: 6%;
            margin: 3%;
        }

        #gameover_img {
            width: 100%;
        }

    </style>
</head>


<body onload="createAnswer();createGameScene();">
    <div id="game_wrapper">
        <div id="header">Header</div>
        <div id="nav">Nav</div>
        <div id="aside">Aside</div>
        <div id="scene_view">
        </div>
        <div id="footer">Footer</div>
    </div>
</body>
